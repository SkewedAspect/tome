//----------------------------------------------------------------------------------------------------------------------
// HistoryManager
//----------------------------------------------------------------------------------------------------------------------

import { BehaviorSubject } from 'rxjs';

// Managers
import wikiMan from './wiki';

// Resource Access
import historyRA from '../resource-access/history';

//----------------------------------------------------------------------------------------------------------------------

class HistoryManager
{
    constructor()
    {
        // Subjects
        this._currentPageHistorySubject = new BehaviorSubject(undefined);
    } // end constructor

    //------------------------------------------------------------------------------------------------------------------
    // Observables
    //------------------------------------------------------------------------------------------------------------------

    get currentPageHistory$() { return this._currentPageHistorySubject.asObservable(); }

    //------------------------------------------------------------------------------------------------------------------
    // Properties
    //------------------------------------------------------------------------------------------------------------------

    get currentPageHistory() { return this._currentPageHistorySubject.getValue(); }

    //------------------------------------------------------------------------------------------------------------------
    // Public
    //------------------------------------------------------------------------------------------------------------------

    selectPage(path)
    {
        return wikiMan.selectPage(path)
            .then(() =>
            {
                return historyRA.getHistory(path)
                    .then((pageHistory) =>
                    {
                        this._currentPageHistorySubject.next(pageHistory);
                    });
            });
    } // end selectPage
} // end HistoryManager

//----------------------------------------------------------------------------------------------------------------------

export default new HistoryManager();

//----------------------------------------------------------------------------------------------------------------------
